<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.security.user_security.mapper.UserMapper">

    <resultMap id="BaseResultMap" type="com.security.user_security.pojo.User">
        <id column="id" property="id" jdbcType="VARCHAR"/>
        <result column="username" property="username" jdbcType="VARCHAR"/>
        <result column="password" property="password" jdbcType="VARCHAR"/>
        <result column="permission" property="permission" jdbcType="VARCHAR"/>
        <result column="idnumber" property="idnumber" jdbcType="VARCHAR"/>
        <result column="phone" property="phone" jdbcType="VARCHAR"/>
        <result column="channel" property="channel" jdbcType="VARCHAR"/>
    </resultMap>
    <sql id="Base_Column_List">
        id,username,password,permission,idnumber,phone,channel
    </sql>
    <insert id="addUser" parameterType="com.security.user_security.pojo.User">
        insert into tb_user(id,username,password,idnumber,phone,channel)
        values(#{id},#{username},#{password},#{idnumber},#{phone},#{channel})
    </insert>
    <select id="queryUserByPhoneWithPassword" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from tb_user
        where phone=#{enphone} and password=#{enpassword}
    </select>

    <update id="updateUserById" parameterType="com.security.user_security.pojo.User">
        update tb_user set username=#{username},password=#{password},idnumber=#{idnumber},channel=#{channel}
        where id=#{id}
    </update>

    <select id="selectUserForConditionByPage" parameterType="map" resultMap="BaseResultMap">
        select <include refid="Base_Column_List"/>
        from tb_user
        <where>
            <if test="username!=null and username!=''">
                username like '%${username}%'
            </if>
            <if test="phone!=null and phone!=''">
                and phone like '%${phone}%'
            </if>
            <if test="channel!=null and channel!=''">
                and channel like '%${channel}%'
            </if>
        </where>
    </select>

    <select id="selectUsersByIds" parameterType="string" resultMap="BaseResultMap">
        select <include refid="Base_Column_List"/>
        from tb_user
        where id in
        <foreach collection="array" item="id" separator="," open="(" close=")">
            #{id}
        </foreach>
    </select>

    <update id="updateUser" parameterType="com.security.user_security.pojo.User">
        update tb_user set username=#{username},password=#{password},permission=#{permission},idnumber=#{idnumber},
                           phone=#{phone},channel=#{channel}
        where id=#{id}
    </update>

    <select id="selectUserById" parameterType="string" resultMap="BaseResultMap">
        select <include refid="Base_Column_List"/>
        from tb_user
        where id=#{id}
    </select>

</mapper>